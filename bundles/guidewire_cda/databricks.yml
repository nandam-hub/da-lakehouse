bundle:
  name: guidewire_cda__raw

resources: {}

include:
  - ../_common.yml
  - resources/raw.schema.yml
  - resources/raw.volume.yml

#############################################################################
### Define blocks that can be reused in multiple targets
#############################################################################

# Used in Each Target
workspace_config: &workspace_config
  host: ${DATABRICKS_HOST}
  # Where `databricks bundle deploy` will place the bundle contents
  root_path: /Workspace/deployment/${var.lh_environment}/${bundle.name}/${bundle.target}/

# Permissions, by lh-environment
sandbox_permissions: &sandbox_permissions
  - level: CAN_MANAGE
    group_name: LakehouseEnterpriseWorkspaceAdmin
  - level: CAN_MANAGE
    group_name: LakehouseEnterpriseExpertDataEngineer
  - level: CAN_MANAGE
    user_name: ${workspace.current_user.userName}
  - level: CAN_MANAGE
    group_name: LakehouseEnterpriseWorkspaceDataEngineer
  - level: CAN_VIEW
    group_name: users

  - level: CAN_MANAGE
    service_principal_name: ${var.service_principals.sandbox}

dev_permissions: &dev_permissions
  - level: CAN_MANAGE
    group_name: LakehouseEnterpriseWorkspaceAdmin
  - level: CAN_MANAGE
    group_name: LakehouseEnterpriseExpertDataEngineer
  - level: CAN_MANAGE
    user_name: ${workspace.current_user.userName}
  - level: CAN_MANAGE
    group_name: LakehouseEnterpriseWorkspaceDataEngineer
  - level: CAN_VIEW
    group_name: users

  - level: CAN_MANAGE
    service_principal_name: ${var.service_principals.dev}

test_permissions: &test_permissions
  - level: CAN_MANAGE
    group_name: LakehouseEnterpriseWorkspaceAdmin
  - level: CAN_MANAGE
    group_name: LakehouseEnterpriseExpertDataEngineer
  - level: CAN_MANAGE
    user_name: ${workspace.current_user.userName}
  - level: CAN_MANAGE
    group_name: LakehouseEnterpriseWorkspaceDataEngineer
  - level: CAN_VIEW
    group_name: users

  - level: CAN_MANAGE
    service_principal_name: ${var.service_principals.test}

qas_permissions: &qas_permissions
  - level: CAN_MANAGE
    group_name: LakehouseEnterpriseWorkspaceAdmin
  - level: CAN_MANAGE
    group_name: LakehouseEnterpriseExpertDataEngineer
  - level: CAN_MANAGE
    user_name: ${workspace.current_user.userName}
  - level: CAN_MANAGE
    group_name: LakehouseEnterpriseWorkspaceDataEngineer
  - level: CAN_VIEW
    group_name: users

  - level: CAN_MANAGE
    service_principal_name: ${var.service_principals.test}

prod_permissions: &prod_permissions
  - level: CAN_MANAGE
    group_name: LakehouseEnterpriseWorkspaceAdmin
  - level: CAN_MANAGE
    group_name: LakehouseEnterpriseExpertDataEngineer
  - level: CAN_MANAGE
    user_name: ${workspace.current_user.userName}
  - level: CAN_MANAGE
    group_name: LakehouseEnterpriseWorkspaceDataEngineer
  - level: CAN_VIEW
    group_name: users

  - level: CAN_MANAGE
    service_principal_name: ${var.service_principals.prod}

# Variables, by lh-environment
sandbox_variable_block: &sandbox_variable_block
  service_principal_object_owner: ${var.service_principals.sandbox}
  aws_environment: sandbox
  lh_environment: sandbox

dev_variable_block: &dev_variable_block
  service_principal_object_owner: ${var.service_principals.dev}
  aws_environment: dev
  lh_environment: dev

test_variable_block: &test_variable_block
  service_principal_object_owner: ${var.service_principals.test}
  aws_environment: test
  lh_environment: test
#############################################################################
### Databricks Asset Bundle Deployment Targets
#############################################################################

targets:
  sandbox:
    mode: production
    workspace: *workspace_config
    permissions: *sandbox_permissions
    variables:
      <<: *sandbox_variable_block
      amic_environment: sandbox

  dev:
    mode: production
    workspace: *workspace_config
    permissions: *dev_permissions
    variables:
      <<: *dev_variable_block
      amic_environment: dev

  test:
    mode: production
    workspace: *workspace_config
    permissions: *dev_permissions
    variables:
      <<: *dev_variable_block
      amic_environment: test
